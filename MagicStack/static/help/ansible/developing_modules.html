

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset=UTF-8"utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Google Tag Manager Data Layer -->
  <script>
   dataLayer = [];
  </script>
  <!-- End Google Tag Manager Data Layer -->

  
  <title>Developing Modules &mdash; Ansible Documentation</title>
  

  
  

  
  <link href="css-family=Lato-400,700-Roboto+Slab-400,700-Inconsolata-400,700.css" tppabs="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" rel='stylesheet' type='text/css'>
  <link href="font-awesome.min.css" tppabs="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.0.3/css/font-awesome.min.css" rel='stylesheet' type='text/css'>

  
  

    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:'./',
        VERSION:'https://docs.ansible.com/ansible/0.01',
        COLLAPSE_INDEX:false,
        FILE_SUFFIX:'.html',
        HAS_SOURCE:  false
      };
    </script>
      <script type="text/javascript" src="jquery.js" tppabs="https://docs.ansible.com/ansible/_static/jquery.js"></script>
      <script type="text/javascript" src="underscore.js" tppabs="https://docs.ansible.com/ansible/_static/underscore.js"></script>
      <script type="text/javascript" src="doctools.js" tppabs="https://docs.ansible.com/ansible/_static/doctools.js"></script>

    

  

  
  
    <link rel="stylesheet" href="theme.min.css" tppabs="https://docs.ansible.com/ansible/_static/css/theme.min.css" type="text/css" />
    <script type="text/javascript" src="theme.js" tppabs="https://docs.ansible.com/ansible/_static/js/theme.js"></script>
  

  
    <link rel="top" title="Ansible Documentation" href="index.html"/>
        <link rel="up" title="Developer Information" href="developing.html"/>
        <link rel="next" title="Developing Plugins" href="developing_plugins.html"/>
        <link rel="prev" title="Developing Dynamic Inventory Sources" href="developing_inventory.html"/> 

  <script src="modernizr.min.js" tppabs="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

  <style>
    .search-reset-start {
        color: #463E3F;
        float: right;
        position: relative;
        top: -25px;
        left: -10px;
        z-index: 10;
     }
     .search-reset-start:hover {
        cursor: pointer;
        color: #2980B9;
     }
     #search-box-id {
        padding-right: 25px;
     }
  </style>

  <link href="css-family=Open+Sans-400,300.css" tppabs="https://fonts.googleapis.com/css?family=Open+Sans:400,300"
    rel='stylesheet' type='text/css'>

</head>

<body class="wy-body-for-nav">

  <!-- Google Tag Manager -->
  <noscript><iframe src="ns.html-id=GTM-PSB293" tppabs="https://www.googletagmanager.com/ns.html?id=GTM-PSB293" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'/*tpa=https://docs.ansible.com/ansible/gtm.js*/});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-PSB293');</script>
  <!-- End Google Tag Manager -->

  <a class="DocSite-nav" href="javascript:if(confirm('http://docs.ansible.com/  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='http://docs.ansible.com/'" tppabs="http://docs.ansible.com/">
    <img class="DocSiteNav-logo"
      src="logo_invert.png" tppabs="https://docs.ansible.com/ansible/_static/images/logo_invert.png"
      alt="Ansible Logo">
    <div class="DocSiteNav-title">
      Documentation
    </div>
  </a>

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">

      <div style="background-color:#5bbdbf;height=80px;margin:'auto auto auto auto'">
        <a class="DocSiteProduct-header DocSiteProduct-header--core"
          href="index.htm" tppabs="http://docs.ansible.com/ansible/">
          <div class="DocSiteProduct-productName">
            <div class="DocSiteProduct-logoText">
              ANSIBLE
            </div>
          </div>
        </a>
      </div>

      <div id="menu-id" class="wy-menu wy-menu-vertical" data-spy="affix">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html" tppabs="https://docs.ansible.com/ansible/intro.html">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="intro_installation.html" tppabs="https://docs.ansible.com/ansible/intro_installation.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_getting_started.html" tppabs="https://docs.ansible.com/ansible/intro_getting_started.html">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_inventory.html" tppabs="https://docs.ansible.com/ansible/intro_inventory.html">Inventory</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_dynamic_inventory.html" tppabs="https://docs.ansible.com/ansible/intro_dynamic_inventory.html">Dynamic Inventory</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_patterns.html" tppabs="https://docs.ansible.com/ansible/intro_patterns.html">Patterns</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_adhoc.html" tppabs="https://docs.ansible.com/ansible/intro_adhoc.html">Introduction To Ad-Hoc Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_configuration.html" tppabs="https://docs.ansible.com/ansible/intro_configuration.html">Configuration file</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_bsd.html" tppabs="https://docs.ansible.com/ansible/intro_bsd.html">BSD Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_windows.html" tppabs="https://docs.ansible.com/ansible/intro_windows.html">Windows Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_networking.html" tppabs="https://docs.ansible.com/ansible/intro_networking.html">Networking Support</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html" tppabs="https://docs.ansible.com/ansible/quickstart.html">Quickstart Video</a></li>
<li class="toctree-l1"><a class="reference internal" href="playbooks.html" tppabs="https://docs.ansible.com/ansible/playbooks.html">Playbooks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="playbooks_intro.html" tppabs="https://docs.ansible.com/ansible/playbooks_intro.html">Intro to Playbooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_roles.html" tppabs="https://docs.ansible.com/ansible/playbooks_roles.html">Playbook Roles and Include Statements</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_variables.html" tppabs="https://docs.ansible.com/ansible/playbooks_variables.html">Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_filters.html" tppabs="https://docs.ansible.com/ansible/playbooks_filters.html">Jinja2 filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_conditionals.html" tppabs="https://docs.ansible.com/ansible/playbooks_conditionals.html">Conditionals</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_loops.html" tppabs="https://docs.ansible.com/ansible/playbooks_loops.html">Loops</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_blocks.html" tppabs="https://docs.ansible.com/ansible/playbooks_blocks.html">Blocks</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_strategies.html" tppabs="https://docs.ansible.com/ansible/playbooks_strategies.html">Strategies</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_best_practices.html" tppabs="https://docs.ansible.com/ansible/playbooks_best_practices.html">Best Practices</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="playbooks_special_topics.html" tppabs="https://docs.ansible.com/ansible/playbooks_special_topics.html">Playbooks: Special Topics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="become.html" tppabs="https://docs.ansible.com/ansible/become.html">Become (Privilege Escalation)</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_acceleration.html" tppabs="https://docs.ansible.com/ansible/playbooks_acceleration.html">Accelerated Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_async.html" tppabs="https://docs.ansible.com/ansible/playbooks_async.html">Asynchronous Actions and Polling</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_checkmode.html" tppabs="https://docs.ansible.com/ansible/playbooks_checkmode.html">Check Mode (&#8220;Dry Run&#8221;)</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_debugger.html" tppabs="https://docs.ansible.com/ansible/playbooks_debugger.html">Playbook Debugger</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_delegation.html" tppabs="https://docs.ansible.com/ansible/playbooks_delegation.html">Delegation, Rolling Updates, and Local Actions</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_environment.html" tppabs="https://docs.ansible.com/ansible/playbooks_environment.html">Setting the Environment (and Working With Proxies)</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_error_handling.html" tppabs="https://docs.ansible.com/ansible/playbooks_error_handling.html">Error Handling In Playbooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_advanced_syntax.html" tppabs="https://docs.ansible.com/ansible/playbooks_advanced_syntax.html">Advanced Syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_lookups.html" tppabs="https://docs.ansible.com/ansible/playbooks_lookups.html">Using Lookups</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_prompts.html" tppabs="https://docs.ansible.com/ansible/playbooks_prompts.html">Prompts</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_tags.html" tppabs="https://docs.ansible.com/ansible/playbooks_tags.html">Tags</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_vault.html" tppabs="https://docs.ansible.com/ansible/playbooks_vault.html">Vault</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_startnstep.html" tppabs="https://docs.ansible.com/ansible/playbooks_startnstep.html">Start and Step</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_directives.html" tppabs="https://docs.ansible.com/ansible/playbooks_directives.html">Directives Glossary</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="modules.html" tppabs="https://docs.ansible.com/ansible/modules.html">About Modules</a><ul>
<li class="toctree-l2"><a class="reference internal" href="modules_intro.html" tppabs="https://docs.ansible.com/ansible/modules_intro.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="modules_core.html" tppabs="https://docs.ansible.com/ansible/modules_core.html">Core Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="modules_extra.html" tppabs="https://docs.ansible.com/ansible/modules_extra.html">Extras Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="common_return_values.html" tppabs="https://docs.ansible.com/ansible/common_return_values.html">Common Return Values</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="modules_by_category.html" tppabs="https://docs.ansible.com/ansible/modules_by_category.html">Module Index</a><ul>
<li class="toctree-l2"><a class="reference internal" href="list_of_all_modules.html" tppabs="https://docs.ansible.com/ansible/list_of_all_modules.html">All Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="javascript:if(confirm('https://docs.ansible.com/ansible/list_of_cloud_modules.html  \n\n该文件无法用 Teleport Ultra 下载, 因为 不可用, 或放弃了下载, 或项目即将停止。  \n\n你想在服务器上打开它?'))window.location='https://docs.ansible.com/ansible/list_of_cloud_modules.html'" tppabs="https://docs.ansible.com/ansible/list_of_cloud_modules.html">Cloud Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="list_of_clustering_modules.html" tppabs="https://docs.ansible.com/ansible/list_of_clustering_modules.html">Clustering Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="list_of_commands_modules.html" tppabs="https://docs.ansible.com/ansible/list_of_commands_modules.html">Commands Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="list_of_database_modules.html" tppabs="https://docs.ansible.com/ansible/list_of_database_modules.html">Database Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="list_of_files_modules.html" tppabs="https://docs.ansible.com/ansible/list_of_files_modules.html">Files Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="list_of_inventory_modules.html" tppabs="https://docs.ansible.com/ansible/list_of_inventory_modules.html">Inventory Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="list_of_messaging_modules.html" tppabs="https://docs.ansible.com/ansible/list_of_messaging_modules.html">Messaging Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="list_of_monitoring_modules.html" tppabs="https://docs.ansible.com/ansible/list_of_monitoring_modules.html">Monitoring Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="list_of_network_modules.html" tppabs="https://docs.ansible.com/ansible/list_of_network_modules.html">Network Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="list_of_notification_modules.html" tppabs="https://docs.ansible.com/ansible/list_of_notification_modules.html">Notification Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="list_of_packaging_modules.html" tppabs="https://docs.ansible.com/ansible/list_of_packaging_modules.html">Packaging Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="list_of_source_control_modules.html" tppabs="https://docs.ansible.com/ansible/list_of_source_control_modules.html">Source Control Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="list_of_system_modules.html" tppabs="https://docs.ansible.com/ansible/list_of_system_modules.html">System Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="list_of_utilities_modules.html" tppabs="https://docs.ansible.com/ansible/list_of_utilities_modules.html">Utilities Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="list_of_web_infrastructure_modules.html" tppabs="https://docs.ansible.com/ansible/list_of_web_infrastructure_modules.html">Web Infrastructure Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="list_of_windows_modules.html" tppabs="https://docs.ansible.com/ansible/list_of_windows_modules.html">Windows Modules</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="guides.html" tppabs="https://docs.ansible.com/ansible/guides.html">Detailed Guides</a><ul>
<li class="toctree-l2"><a class="reference internal" href="guide_aws.html" tppabs="https://docs.ansible.com/ansible/guide_aws.html">Amazon Web Services Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="guide_azure.html" tppabs="https://docs.ansible.com/ansible/guide_azure.html">Getting Started with Azure</a></li>
<li class="toctree-l2"><a class="reference internal" href="guide_rax.html" tppabs="https://docs.ansible.com/ansible/guide_rax.html">Rackspace Cloud Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="guide_gce.html" tppabs="https://docs.ansible.com/ansible/guide_gce.html">Google Cloud Platform Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="guide_cloudstack.html" tppabs="https://docs.ansible.com/ansible/guide_cloudstack.html">CloudStack Cloud Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="guide_vagrant.html" tppabs="https://docs.ansible.com/ansible/guide_vagrant.html">Using Vagrant and Ansible</a></li>
<li class="toctree-l2"><a class="reference internal" href="guide_rolling_upgrade.html" tppabs="https://docs.ansible.com/ansible/guide_rolling_upgrade.html">Continuous Delivery and Rolling Upgrades</a></li>
<li class="toctree-l2"><a class="reference internal" href="guide_docker.html" tppabs="https://docs.ansible.com/ansible/guide_docker.html">Getting Started with Docker</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="developing.html" tppabs="https://docs.ansible.com/ansible/developing.html">Developer Information</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="developing_api.html" tppabs="https://docs.ansible.com/ansible/developing_api.html">Python API</a></li>
<li class="toctree-l2"><a class="reference internal" href="developing_inventory.html" tppabs="https://docs.ansible.com/ansible/developing_inventory.html">Developing Dynamic Inventory Sources</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Developing Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="developing_plugins.html" tppabs="https://docs.ansible.com/ansible/developing_plugins.html">Developing Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="developing_core.html" tppabs="https://docs.ansible.com/ansible/developing_core.html">Developing the Ansible Core Engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="developing_test_pr.html" tppabs="https://docs.ansible.com/ansible/developing_test_pr.html">Helping Testing PRs</a></li>
<li class="toctree-l2"><a class="reference internal" href="developing_releases.html" tppabs="https://docs.ansible.com/ansible/developing_releases.html">Releases</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tower.html" tppabs="https://docs.ansible.com/ansible/tower.html">Ansible Tower</a></li>
<li class="toctree-l1"><a class="reference internal" href="community.html" tppabs="https://docs.ansible.com/ansible/community.html">Community Information &amp; Contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="community.html#ansible-users" tppabs="https://docs.ansible.com/ansible/community.html#ansible-users">Ansible Users</a></li>
<li class="toctree-l2"><a class="reference internal" href="community.html#for-current-and-prospective-developers" tppabs="https://docs.ansible.com/ansible/community.html#for-current-and-prospective-developers">For Current and Prospective Developers</a></li>
<li class="toctree-l2"><a class="reference internal" href="community.html#other-topics" tppabs="https://docs.ansible.com/ansible/community.html#other-topics">Other Topics</a></li>
<li class="toctree-l2"><a class="reference internal" href="community.html#community-code-of-conduct" tppabs="https://docs.ansible.com/ansible/community.html#community-code-of-conduct">Community Code of Conduct</a></li>
<li class="toctree-l2"><a class="reference internal" href="community.html#contributors-license-agreement" tppabs="https://docs.ansible.com/ansible/community.html#contributors-license-agreement">Contributors License Agreement</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="galaxy.html" tppabs="https://docs.ansible.com/ansible/galaxy.html">Ansible Galaxy</a><ul>
<li class="toctree-l2"><a class="reference internal" href="galaxy.html#the-website" tppabs="https://docs.ansible.com/ansible/galaxy.html#the-website">The Website</a></li>
<li class="toctree-l2"><a class="reference internal" href="galaxy.html#the-ansible-galaxy-command-line-tool" tppabs="https://docs.ansible.com/ansible/galaxy.html#the-ansible-galaxy-command-line-tool">The ansible-galaxy command line tool</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="test_strategies.html" tppabs="https://docs.ansible.com/ansible/test_strategies.html">Testing Strategies</a><ul>
<li class="toctree-l2"><a class="reference internal" href="test_strategies.html#integrating-testing-with-ansible-playbooks" tppabs="https://docs.ansible.com/ansible/test_strategies.html#integrating-testing-with-ansible-playbooks">Integrating Testing With Ansible Playbooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_strategies.html#the-right-level-of-testing" tppabs="https://docs.ansible.com/ansible/test_strategies.html#the-right-level-of-testing">The Right Level of Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_strategies.html#check-mode-as-a-drift-test" tppabs="https://docs.ansible.com/ansible/test_strategies.html#check-mode-as-a-drift-test">Check Mode As A Drift Test</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_strategies.html#modules-that-are-useful-for-testing" tppabs="https://docs.ansible.com/ansible/test_strategies.html#modules-that-are-useful-for-testing">Modules That Are Useful for Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_strategies.html#testing-lifecycle" tppabs="https://docs.ansible.com/ansible/test_strategies.html#testing-lifecycle">Testing Lifecycle</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_strategies.html#integrating-testing-with-rolling-updates" tppabs="https://docs.ansible.com/ansible/test_strategies.html#integrating-testing-with-rolling-updates">Integrating Testing With Rolling Updates</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_strategies.html#achieving-continuous-deployment" tppabs="https://docs.ansible.com/ansible/test_strategies.html#achieving-continuous-deployment">Achieving Continuous Deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_strategies.html#conclusion" tppabs="https://docs.ansible.com/ansible/test_strategies.html#conclusion">Conclusion</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="faq.html" tppabs="https://docs.ansible.com/ansible/faq.html">Frequently Asked Questions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-can-i-set-the-path-or-any-other-environment-variable-for-a-task-or-entire-playbook" tppabs="https://docs.ansible.com/ansible/faq.html#how-can-i-set-the-path-or-any-other-environment-variable-for-a-task-or-entire-playbook">How can I set the PATH or any other environment variable for a task or entire playbook?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-handle-different-machines-needing-different-user-accounts-or-ports-to-log-in-with" tppabs="https://docs.ansible.com/ansible/faq.html#how-do-i-handle-different-machines-needing-different-user-accounts-or-ports-to-log-in-with">How do I handle different machines needing different user accounts or ports to log in with?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-get-ansible-to-reuse-connections-enable-kerberized-ssh-or-have-ansible-pay-attention-to-my-local-ssh-config-file" tppabs="https://docs.ansible.com/ansible/faq.html#how-do-i-get-ansible-to-reuse-connections-enable-kerberized-ssh-or-have-ansible-pay-attention-to-my-local-ssh-config-file">How do I get ansible to reuse connections, enable Kerberized SSH, or have Ansible pay attention to my local SSH config file?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-configure-a-jump-host-to-access-servers-that-i-have-no-direct-access-to" tppabs="https://docs.ansible.com/ansible/faq.html#how-do-i-configure-a-jump-host-to-access-servers-that-i-have-no-direct-access-to">How do I configure a jump host to access servers that I have no direct access to?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-speed-up-management-inside-ec2" tppabs="https://docs.ansible.com/ansible/faq.html#how-do-i-speed-up-management-inside-ec2">How do I speed up management inside EC2?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-handle-python-pathing-not-having-a-python-2-x-in-usr-bin-python-on-a-remote-machine" tppabs="https://docs.ansible.com/ansible/faq.html#how-do-i-handle-python-pathing-not-having-a-python-2-x-in-usr-bin-python-on-a-remote-machine">How do I handle python pathing not having a Python 2.X in /usr/bin/python on a remote machine?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#what-is-the-best-way-to-make-content-reusable-redistributable" tppabs="https://docs.ansible.com/ansible/faq.html#what-is-the-best-way-to-make-content-reusable-redistributable">What is the best way to make content reusable/redistributable?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#where-does-the-configuration-file-live-and-what-can-i-configure-in-it" tppabs="https://docs.ansible.com/ansible/faq.html#where-does-the-configuration-file-live-and-what-can-i-configure-in-it">Where does the configuration file live and what can I configure in it?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-disable-cowsay" tppabs="https://docs.ansible.com/ansible/faq.html#how-do-i-disable-cowsay">How do I disable cowsay?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-see-a-list-of-all-of-the-ansible-variables" tppabs="https://docs.ansible.com/ansible/faq.html#how-do-i-see-a-list-of-all-of-the-ansible-variables">How do I see a list of all of the ansible_ variables?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-see-all-the-inventory-vars-defined-for-my-host" tppabs="https://docs.ansible.com/ansible/faq.html#how-do-i-see-all-the-inventory-vars-defined-for-my-host">How do I see all the inventory vars defined for my host?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-loop-over-a-list-of-hosts-in-a-group-inside-of-a-template" tppabs="https://docs.ansible.com/ansible/faq.html#how-do-i-loop-over-a-list-of-hosts-in-a-group-inside-of-a-template">How do I loop over a list of hosts in a group, inside of a template?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-access-a-variable-name-programmatically" tppabs="https://docs.ansible.com/ansible/faq.html#how-do-i-access-a-variable-name-programmatically">How do I access a variable name programmatically?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-access-a-variable-of-the-first-host-in-a-group" tppabs="https://docs.ansible.com/ansible/faq.html#how-do-i-access-a-variable-of-the-first-host-in-a-group">How do I access a variable of the first host in a group?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-copy-files-recursively-onto-a-target-host" tppabs="https://docs.ansible.com/ansible/faq.html#how-do-i-copy-files-recursively-onto-a-target-host">How do I copy files recursively onto a target host?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-access-shell-environment-variables" tppabs="https://docs.ansible.com/ansible/faq.html#how-do-i-access-shell-environment-variables">How do I access shell environment variables?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-generate-crypted-passwords-for-the-user-module" tppabs="https://docs.ansible.com/ansible/faq.html#how-do-i-generate-crypted-passwords-for-the-user-module">How do I generate crypted passwords for the user module?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#can-i-get-training-on-ansible-or-find-commercial-support" tppabs="https://docs.ansible.com/ansible/faq.html#can-i-get-training-on-ansible-or-find-commercial-support">Can I get training on Ansible or find commercial support?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#is-there-a-web-interface-rest-api-etc" tppabs="https://docs.ansible.com/ansible/faq.html#is-there-a-web-interface-rest-api-etc">Is there a web interface / REST API / etc?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-submit-a-change-to-the-documentation" tppabs="https://docs.ansible.com/ansible/faq.html#how-do-i-submit-a-change-to-the-documentation">How do I submit a change to the documentation?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-keep-secret-data-in-my-playbook" tppabs="https://docs.ansible.com/ansible/faq.html#how-do-i-keep-secret-data-in-my-playbook">How do I keep secret data in my playbook?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#when-should-i-use-also-how-to-interpolate-variables-or-dynamic-variable-names" tppabs="https://docs.ansible.com/ansible/faq.html#when-should-i-use-also-how-to-interpolate-variables-or-dynamic-variable-names">When should I use {{ }}? Also, how to interpolate variables or dynamic variable names</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#i-don-t-see-my-question-here" tppabs="https://docs.ansible.com/ansible/faq.html#i-don-t-see-my-question-here">I don&#8217;t see my question here</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html" tppabs="https://docs.ansible.com/ansible/glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="YAMLSyntax.html" tppabs="https://docs.ansible.com/ansible/YAMLSyntax.html">YAML Syntax</a><ul>
<li class="toctree-l2"><a class="reference internal" href="YAMLSyntax.html#yaml-basics" tppabs="https://docs.ansible.com/ansible/YAMLSyntax.html#yaml-basics">YAML Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="YAMLSyntax.html#gotchas" tppabs="https://docs.ansible.com/ansible/YAMLSyntax.html#gotchas">Gotchas</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="porting_guide_2.0.html" tppabs="https://docs.ansible.com/ansible/porting_guide_2.0.html">Porting Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="porting_guide_2.0.html#playbook" tppabs="https://docs.ansible.com/ansible/porting_guide_2.0.html#playbook">Playbook</a></li>
<li class="toctree-l2"><a class="reference internal" href="porting_guide_2.0.html#deprecated" tppabs="https://docs.ansible.com/ansible/porting_guide_2.0.html#deprecated">Deprecated</a></li>
<li class="toctree-l2"><a class="reference internal" href="porting_guide_2.0.html#other-caveats" tppabs="https://docs.ansible.com/ansible/porting_guide_2.0.html#other-caveats">Other caveats</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="porting_guide_2.0.html#porting-plugins" tppabs="https://docs.ansible.com/ansible/porting_guide_2.0.html#porting-plugins">Porting plugins</a><ul>
<li class="toctree-l2"><a class="reference internal" href="porting_guide_2.0.html#lookup-plugins" tppabs="https://docs.ansible.com/ansible/porting_guide_2.0.html#lookup-plugins">Lookup plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="porting_guide_2.0.html#connection-plugins" tppabs="https://docs.ansible.com/ansible/porting_guide_2.0.html#connection-plugins">Connection plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="porting_guide_2.0.html#action-plugins" tppabs="https://docs.ansible.com/ansible/porting_guide_2.0.html#action-plugins">Action plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="porting_guide_2.0.html#callback-plugins" tppabs="https://docs.ansible.com/ansible/porting_guide_2.0.html#callback-plugins">Callback plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="porting_guide_2.0.html#id1" tppabs="https://docs.ansible.com/ansible/porting_guide_2.0.html#id1">Connection plugins</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="porting_guide_2.0.html#hybrid-plugins" tppabs="https://docs.ansible.com/ansible/porting_guide_2.0.html#hybrid-plugins">Hybrid plugins</a><ul>
<li class="toctree-l2"><a class="reference internal" href="porting_guide_2.0.html#id2" tppabs="https://docs.ansible.com/ansible/porting_guide_2.0.html#id2">Lookup plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="porting_guide_2.0.html#id3" tppabs="https://docs.ansible.com/ansible/porting_guide_2.0.html#id3">Connection plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="porting_guide_2.0.html#id4" tppabs="https://docs.ansible.com/ansible/porting_guide_2.0.html#id4">Action plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="porting_guide_2.0.html#id5" tppabs="https://docs.ansible.com/ansible/porting_guide_2.0.html#id5">Callback plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="porting_guide_2.0.html#id6" tppabs="https://docs.ansible.com/ansible/porting_guide_2.0.html#id6">Connection plugins</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="porting_guide_2.0.html#porting-custom-scripts" tppabs="https://docs.ansible.com/ansible/porting_guide_2.0.html#porting-custom-scripts">Porting custom scripts</a></li>
</ul>

        

<!-- changeable widget -->
<center>
<br/>
<a href="javascript:if(confirm('http://www.ansible.com/docs-left?utm_source=docs  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='http://www.ansible.com/docs-left?utm_source=docs'" tppabs="http://www.ansible.com/docs-left?utm_source=docs">
    <img style="border-width:0px;" src="ASB-docs-left-rail.png" tppabs="https://cdn2.hubspot.net/hubfs/330046/docs-graphics/ASB-docs-left-rail.png" />
</a>
</center>


      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top">
        <i data-toggle="wy-nav-top" class="icon icon-reorder"></i>
        <a href="javascript:if(confirm('https://docs.ansible.com/  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='https://docs.ansible.com/'" tppabs="https://docs.ansible.com/">Ansible Documentation</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">

          <!-- Banner ads -->
          <div class="DocSiteBanner">
            <a class="DocSiteBanner-imgWrapper"
                href="javascript:if(confirm('http://www.ansible.com/docs-top?utm_source=docs  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='http://www.ansible.com/docs-top?utm_source=docs'" tppabs="http://www.ansible.com/docs-top?utm_source=docs">
                <img src="ASB-docs-top-left.png" tppabs="https://cdn2.hubspot.net/hubfs/330046/docs-graphics/ASB-docs-top-left.png">
            </a>
            <a class="DocSiteBanner-imgWrapper"
                href="javascript:if(confirm('http://www.ansible.com/docs-top?utm_source=docs  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='http://www.ansible.com/docs-top?utm_source=docs'" tppabs="http://www.ansible.com/docs-top?utm_source=docs">
                <img src="ASB-docs-top-right.png" tppabs="https://cdn2.hubspot.net/hubfs/330046/docs-graphics/ASB-docs-top-right.png">
            </a>
        </div>

          <ul class="wy-breadcrumbs">
  <li><a href="index.html" tppabs="https://docs.ansible.com/ansible/index.html">Docs</a> &raquo;</li>
  <li><a href="">Developing Modules</a></li>
  
    <li class="wy-breadcrumbs-aside">
      <a href="javascript:if(confirm('https://github.com/ansible/ansible/blob/devel/docsite/rst/developing_modules.rst  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='https://github.com/ansible/ansible/blob/devel/docsite/rst/developing_modules.rst'" tppabs="https://github.com/ansible/ansible/blob/devel/docsite/rst/developing_modules.rst" class="icon icon-github"> Edit on GitHub</a>
    </li>
  
</ul>
<hr/>

          <div id="page-content">
          
  <div class="section" id="developing-modules">
<h1><a class="toc-backref" href="#id6">Developing Modules</a><a class="headerlink" href="#developing-modules" title="Permalink to this headline">露</a></h1>
<div class="contents topic" id="topics">
<p class="topic-title first">Topics</p>
<ul class="simple">
<li><a class="reference internal" href="#developing-modules" id="id6">Developing Modules</a><ul>
<li><a class="reference internal" href="#tutorial" id="id7">Tutorial</a></li>
<li><a class="reference internal" href="#testing-modules" id="id8">Testing Modules</a></li>
<li><a class="reference internal" href="#reading-input" id="id9">Reading Input</a><ul>
<li><a class="reference internal" href="#binary-modules-input" id="id10">Binary Modules Input</a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-provided-facts" id="id11">Module Provided &#8216;Facts&#8217;</a></li>
<li><a class="reference internal" href="#common-module-boilerplate" id="id12">Common Module Boilerplate</a></li>
<li><a class="reference internal" href="#check-mode" id="id13">Check Mode</a></li>
<li><a class="reference internal" href="#common-pitfalls" id="id14">Common Pitfalls</a></li>
<li><a class="reference internal" href="#conventions-recommendations" id="id15">Conventions/Recommendations</a></li>
<li><a class="reference internal" href="#documenting-your-module" id="id16">Documenting Your Module</a><ul>
<li><a class="reference internal" href="#example" id="id17">Example</a></li>
<li><a class="reference internal" href="#building-testing" id="id18">Building &amp; Testing</a></li>
</ul>
</li>
<li><a class="reference internal" href="#debugging-ansiblemodule-based-modules" id="id19">Debugging AnsibleModule-based modules</a></li>
<li><a class="reference internal" href="#module-paths" id="id20">Module Paths</a></li>
<li><a class="reference internal" href="#getting-your-module-into-ansible" id="id21">Getting Your Module Into Ansible</a></li>
<li><a class="reference internal" href="#module-checklist" id="id22">Module checklist</a></li>
<li><a class="reference internal" href="#windows-modules-checklist" id="id23">Windows modules checklist</a></li>
<li><a class="reference internal" href="#deprecating-and-making-module-aliases" id="id24">Deprecating and making module aliases</a></li>
</ul>
</li>
</ul>
</div>
<p>Ansible modules are reusable, standalone scripts that can be used by the Ansible API,
or by the <strong class="command">ansible</strong> or <strong class="command">ansible-playbook</strong> programs.  They
return information to ansible by printing a JSON string to stdout before
exiting.  They take arguments in in one of several ways which we&#8217;ll go into
as we work through this tutorial.</p>
<p>See <a class="reference internal" href="modules.html" tppabs="https://docs.ansible.com/ansible/modules.html"><span class="doc">About Modules</span></a> for a list of various ones developed in core.</p>
<p>Modules can be written in any language and are found in the path specified
by <span class="target" id="index-0"></span><code class="xref std std-envvar docutils literal"><span class="pre">ANSIBLE_LIBRARY</span></code> or the <code class="docutils literal"><span class="pre">--module-path</span></code> command line option.</p>
<p>By default, everything that ships with Ansible is pulled from its source tree, but
additional paths can be added.</p>
<p>The directory i:file:<cite>./library</cite>, alongside your top level <a class="reference internal" href="glossary.html#term-playbooks" tppabs="https://docs.ansible.com/ansible/glossary.html#term-playbooks"><span class="xref std std-term">playbooks</span></a>, is also automatically
added as a search directory.</p>
<p>Should you develop an interesting Ansible module, consider sending a pull request to the
<a class="reference external" href="javascript:if(confirm('https://github.com/ansible/ansible-modules-extras  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='https://github.com/ansible/ansible-modules-extras'" tppabs="https://github.com/ansible/ansible-modules-extras">modules-extras project</a>.  There&#8217;s also a core
repo for more established and widely used modules.  &#8220;Extras&#8221; modules may be promoted to core periodically,
but there&#8217;s no fundamental difference in the end - both ship with Ansible, all in one package, regardless
of how you acquire Ansible.</p>
<div class="section" id="tutorial">
<span id="module-dev-tutorial"></span><h2><a class="toc-backref" href="#id7">Tutorial</a><a class="headerlink" href="#tutorial" title="Permalink to this headline">露</a></h2>
<p>Let&#8217;s build a very-basic module to get and set the system time.  For starters, let&#8217;s build
a module that just outputs the current time.</p>
<p>We are going to use Python here but any language is possible.  Only File I/O and outputting to standard
out are required.  So, bash, C++, clojure, Python, Ruby, whatever you want
is fine.</p>
<p>Now Python Ansible modules contain some extremely powerful shortcuts (that all the core modules use)
but first we are going to build a module the very hard way.  The reason we do this is because modules
written in any language OTHER than Python are going to have to do exactly this.  We&#8217;ll show the easy
way later.</p>
<p>So, here&#8217;s an example.  You would never really need to build a module to set the system time,
the &#8216;command&#8217; module could already be used to do this.</p>
<p>Reading the modules that come with Ansible (linked above) is a great way to learn how to write
modules.   Keep in mind, though, that some modules in Ansible&#8217;s source tree are internalisms,
so look at <a class="reference internal" href="service_module.html#service" tppabs="https://docs.ansible.com/ansible/service_module.html#service"><span class="std std-ref">service - Manage services.</span></a> or <a class="reference internal" href="yum_module.html#yum" tppabs="https://docs.ansible.com/ansible/yum_module.html#yum"><span class="std std-ref">yum - Manages packages with the yum package manager</span></a>, and don&#8217;t stare too close into things like <code class="docutils literal"><span class="pre">async_wrapper</span></code> or
you&#8217;ll turn to stone.  Nobody ever executes <code class="docutils literal"><span class="pre">async_wrapper</span></code> directly.</p>
<p>Ok, let&#8217;s get going with an example.  We&#8217;ll use Python.  For starters, save this as a file named <code class="file docutils literal"><span class="pre">timetest.py</span></code>:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span>#!/usr/bin/python

import datetime
import json

date = str(datetime.datetime.now())
print json.dumps({
    &quot;time&quot; : date
})
</pre></div>
</div>
</div>
<div class="section" id="testing-modules">
<span id="module-testing"></span><h2><a class="toc-backref" href="#id8">Testing Modules</a><a class="headerlink" href="#testing-modules" title="Permalink to this headline">露</a></h2>
<p>There&#8217;s a useful test script in the source checkout for Ansible:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">git clone git://github.com/ansible/ansible.git --recursive</span>
<span class="l l-Scalar l-Scalar-Plain">source ansible/hacking/env-setup</span>
</pre></div>
</div>
<p>For instructions on setting up Ansible from source, please see
<a class="reference internal" href="intro_installation.html" tppabs="https://docs.ansible.com/ansible/intro_installation.html"><span class="doc">Installation</span></a>.</p>
<p>Let&#8217;s run the script you just wrote with that:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">ansible/hacking/test-module -m ./timetest.py</span>
</pre></div>
</div>
<p>You should see output that looks something like this:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="p p-Indicator">{</span><span class="s">&#39;time&#39;</span><span class="p p-Indicator">:</span> <span class="s">&#39;2012-03-14</span><span class="nv"> </span><span class="s">22:13:48.539183&#39;</span><span class="p p-Indicator">}</span>
</pre></div>
</div>
<p>If you did not, you might have a typo in your module, so recheck it and try again.</p>
</div>
<div class="section" id="reading-input">
<span id="id1"></span><h2><a class="toc-backref" href="#id9">Reading Input</a><a class="headerlink" href="#reading-input" title="Permalink to this headline">露</a></h2>
<p>Let&#8217;s modify the module to allow setting the current time.  We&#8217;ll do this by seeing
if a key value pair in the form <cite>time=&lt;string&gt;</cite> is passed in to the module.</p>
<p>Ansible internally saves arguments to an arguments file.  So we must read the file
and parse it.  The arguments file is just a string, so any form of arguments are legal.
Here we&#8217;ll do some basic parsing to treat the input as key=value.</p>
<p>The example usage we are trying to achieve to set the time is:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">time time=&quot;March 14 22:10&quot;</span>
</pre></div>
</div>
<p>If no time parameter is set, we&#8217;ll just leave the time as is and return the current time.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This is obviously an unrealistic idea for a module.  You&#8217;d most likely just
use the command module.  However, it makes for a decent tutorial.</p>
</div>
<p>Let&#8217;s look at the code.  Read the comments as we&#8217;ll explain as we go.  Note that this
is highly verbose because it&#8217;s intended as an educational example.  You can write modules
a lot shorter than this:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span>#!/usr/bin/python

# import some python modules that we&#39;ll use.  These are all
# available in Python&#39;s core

import datetime
import sys
import json
import os
import shlex

# read the argument string from the arguments file
args_file = sys.argv[1]
args_data = file(args_file).read()

# For this module, we&#39;re going to do key=value style arguments.
# Modules can choose to receive json instead by adding the string:
#   WANT_JSON
# Somewhere in the file.
# Modules can also take free-form arguments instead of key-value or json
# but this is not recommended.

arguments = shlex.split(args_data)
for arg in arguments:

    # ignore any arguments without an equals in it
    if &quot;=&quot; in arg:

        (key, value) = arg.split(&quot;=&quot;)

        # if setting the time, the key &#39;time&#39;
        # will contain the value we want to set the time to

        if key == &quot;time&quot;:

            # now we&#39;ll affect the change.  Many modules
            # will strive to be &#39;idempotent&#39;, meaning they
            # will only make changes when the desired state
            # expressed to the module does not match
            # the current state.  Look at &#39;service&#39;
            # or &#39;yum&#39; in the main git tree for an example
            # of how that might look.

            rc = os.system(&quot;date -s \&quot;%s\&quot;&quot; % value)

            # always handle all possible errors
            #
            # when returning a failure, include &#39;failed&#39;
            # in the return data, and explain the failure
            # in &#39;msg&#39;.  Both of these conventions are
            # required however additional keys and values
            # can be added.

            if rc != 0:
                print json.dumps({
                    &quot;failed&quot; : True,
                    &quot;msg&quot;    : &quot;failed setting the time&quot;
                })
                sys.exit(1)

            # when things do not fail, we do not
            # have any restrictions on what kinds of
            # data are returned, but it&#39;s always a
            # good idea to include whether or not
            # a change was made, as that will allow
            # notifiers to be used in playbooks.

            date = str(datetime.datetime.now())
            print json.dumps({
                &quot;time&quot; : date,
                &quot;changed&quot; : True
            })
            sys.exit(0)

# if no parameters are sent, the module may or
# may not error out, this one will just
# return the time

date = str(datetime.datetime.now())
print json.dumps({
    &quot;time&quot; : date
})
</pre></div>
</div>
<p>Let&#8217;s test that module:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">ansible/hacking/test-module -m ./timetest.py -a &quot;time=\&quot;March 14 12:23\&quot;&quot;</span>
</pre></div>
</div>
<p>This should return something like:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="p p-Indicator">{</span><span class="s">&quot;changed&quot;</span><span class="p p-Indicator">:</span> <span class="nv">true</span><span class="p p-Indicator">,</span> <span class="s">&quot;time&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;2012-03-14</span><span class="nv"> </span><span class="s">12:23:00.000307&quot;</span><span class="p p-Indicator">}</span>
</pre></div>
</div>
<div class="section" id="binary-modules-input">
<span id="binary-module-reading-input"></span><h3><a class="toc-backref" href="#id10">Binary Modules Input</a><a class="headerlink" href="#binary-modules-input" title="Permalink to this headline">露</a></h3>
<p>Support for binary modules was added in Ansible 2.2.  When Ansible detects a binary module, it will proceed to
supply the argument input as a file on <code class="docutils literal"><span class="pre">argv[1]</span></code> that is formatted as JSON.  The JSON contents of that file
would resemble something similar to the following payload for a module accepting the same arguments as the
<code class="docutils literal"><span class="pre">ping</span></code> module:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="p p-Indicator">{</span>
    <span class="s">&quot;data&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;pong&quot;</span><span class="p p-Indicator">,</span>
    <span class="s">&quot;_ansible_verbosity&quot;</span><span class="p p-Indicator">:</span> <span class="nv">4</span><span class="p p-Indicator">,</span>
    <span class="s">&quot;_ansible_diff&quot;</span><span class="p p-Indicator">:</span> <span class="nv">false</span><span class="p p-Indicator">,</span>
    <span class="s">&quot;_ansible_debug&quot;</span><span class="p p-Indicator">:</span> <span class="nv">false</span><span class="p p-Indicator">,</span>
    <span class="s">&quot;_ansible_check_mode&quot;</span><span class="p p-Indicator">:</span> <span class="nv">false</span><span class="p p-Indicator">,</span>
    <span class="s">&quot;_ansible_no_log&quot;</span><span class="p p-Indicator">:</span> <span class="nv">false</span>
<span class="p p-Indicator">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="module-provided-facts">
<span id="id2"></span><h2><a class="toc-backref" href="#id11">Module Provided &#8216;Facts&#8217;</a><a class="headerlink" href="#module-provided-facts" title="Permalink to this headline">露</a></h2>
<p>The <a class="reference internal" href="setup_module.html#setup" tppabs="https://docs.ansible.com/ansible/setup_module.html#setup"><span class="std std-ref">setup - Gathers facts about remote hosts</span></a> module that ships with Ansible provides many variables about a system that can be used in playbooks
and templates.  However, it&#8217;s possible to also add your own facts without modifying the system module.  To do
this, just have the module return a <cite>ansible_facts</cite> key, like so, along with other return data:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="p p-Indicator">{</span>
    <span class="s">&quot;changed&quot;</span> <span class="p p-Indicator">:</span> <span class="nv">True</span><span class="p p-Indicator">,</span>
    <span class="s">&quot;rc&quot;</span> <span class="p p-Indicator">:</span> <span class="nv">5</span><span class="p p-Indicator">,</span>
    <span class="s">&quot;ansible_facts&quot;</span> <span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span>
        <span class="s">&quot;leptons&quot;</span> <span class="p p-Indicator">:</span> <span class="nv">5000</span><span class="p p-Indicator">,</span>
        <span class="s">&quot;colors&quot;</span> <span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span>
            <span class="s">&quot;red&quot;</span>   <span class="p p-Indicator">:</span> <span class="s">&quot;FF0000&quot;</span><span class="p p-Indicator">,</span>
            <span class="s">&quot;white&quot;</span> <span class="p p-Indicator">:</span> <span class="s">&quot;FFFFFF&quot;</span>
        <span class="p p-Indicator">}</span>
    <span class="p p-Indicator">}</span>
<span class="p p-Indicator">}</span>
</pre></div>
</div>
<p>These &#8216;facts&#8217; will be available to all statements called after that module (but not before) in the playbook.
A good idea might be to make a module called &#8216;site_facts&#8217; and always call it at the top of each playbook, though
we&#8217;re always open to improving the selection of core facts in Ansible as well.</p>
</div>
<div class="section" id="common-module-boilerplate">
<span id="id3"></span><h2><a class="toc-backref" href="#id12">Common Module Boilerplate</a><a class="headerlink" href="#common-module-boilerplate" title="Permalink to this headline">露</a></h2>
<p>As mentioned, if you are writing a module in Python, there are some very powerful shortcuts you can use.
Modules are still transferred as one file, but an arguments file is no longer needed, so these are not
only shorter in terms of code, they are actually FASTER in terms of execution time.</p>
<p>Rather than mention these here, the best way to learn is to read some of the <a class="reference external" href="javascript:if(confirm('https://github.com/ansible/ansible-modules-core  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='https://github.com/ansible/ansible-modules-core'" tppabs="https://github.com/ansible/ansible-modules-core">source of the modules</a> that come with Ansible.</p>
<p>The &#8216;group&#8217; and &#8216;user&#8217; modules are reasonably non-trivial and showcase what this looks like.</p>
<p>Key parts include always importing the boilerplate code from
<code class="xref py py-mod docutils literal"><span class="pre">ansible.module_utils.basic</span></code> like this:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">from ansible.module_utils.basic import AnsibleModule</span>
<span class="l l-Scalar l-Scalar-Plain">if __name__ == &#39;__main__&#39;</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">main()</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Prior to Ansible-2.1.0, importing only what you used from
<code class="xref py py-mod docutils literal"><span class="pre">ansible.module_utils.basic</span></code> did not work.  You needed to use
a wildcard import like this:</p>
<div class="last highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">from ansible.module_utils.basic import *</span>
</pre></div>
</div>
</div>
<p>And instantiating the module class like:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">def main()</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">module = AnsibleModule(</span>
        <span class="l l-Scalar l-Scalar-Plain">argument_spec = dict(</span>
            <span class="l l-Scalar l-Scalar-Plain">state     = dict(default=&#39;present&#39;, choices=[&#39;present&#39;, &#39;absent&#39;]),</span>
            <span class="l l-Scalar l-Scalar-Plain">name      = dict(required=True),</span>
            <span class="l l-Scalar l-Scalar-Plain">enabled   = dict(required=True, type=&#39;bool&#39;),</span>
            <span class="l l-Scalar l-Scalar-Plain">something = dict(aliases=[&#39;whatever&#39;])</span>
        <span class="l l-Scalar l-Scalar-Plain">)</span>
    <span class="l l-Scalar l-Scalar-Plain">)</span>
</pre></div>
</div>
<p>The <code class="xref py py-class docutils literal"><span class="pre">AnsibleModule</span></code> provides lots of common code for handling returns, parses your arguments
for you, and allows you to check inputs.</p>
<p>Successful returns are made like this:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">module.exit_json(changed=True, something_else=12345)</span>
</pre></div>
</div>
<p>And failures are just as simple (where <cite>msg</cite> is a required parameter to explain the error):</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">module.fail_json(msg=&quot;Something fatal happened&quot;)</span>
</pre></div>
</div>
<p>There are also other useful functions in the module class, such as <code class="xref py py-func docutils literal"><span class="pre">module.sha1(path)()</span></code>.  See
<code class="file docutils literal"><span class="pre">lib/ansible/module_utils/basic.py</span></code> in the source checkout for implementation details.</p>
<p>Again, modules developed this way are best tested with the <code class="file docutils literal"><span class="pre">hacking/test-module</span></code> script in the git
source checkout.  Because of the magic involved, this is really the only way the scripts
can function outside of Ansible.</p>
<p>If submitting a module to Ansible&#8217;s core code, which we encourage, use of
<code class="xref py py-class docutils literal"><span class="pre">AnsibleModule</span></code> is required.</p>
</div>
<div class="section" id="check-mode">
<span id="developing-for-check-mode"></span><h2><a class="toc-backref" href="#id13">Check Mode</a><a class="headerlink" href="#check-mode" title="Permalink to this headline">露</a></h2>
<div class="versionadded">
<p><span class="versionmodified">New in version 1.1.</span></p>
</div>
<p>Modules may optionally support check mode. If the user runs Ansible in check
mode, the module should try to predict whether changes will occur.</p>
<p>For your module to support check mode, you must pass <code class="docutils literal"><span class="pre">supports_check_mode=True</span></code>
when instantiating the AnsibleModule object. The AnsibleModule.check_mode attribute
will evaluate to True when check mode is enabled. For example:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">module = AnsibleModule(</span>
    <span class="l l-Scalar l-Scalar-Plain">argument_spec = dict(...),</span>
    <span class="l l-Scalar l-Scalar-Plain">supports_check_mode=True</span>
<span class="l l-Scalar l-Scalar-Plain">)</span>

<span class="l l-Scalar l-Scalar-Plain">if module.check_mode</span><span class="p p-Indicator">:</span>
    <span class="c1"># Check if any changes would be made but don&#39;t actually make those changes</span>
    <span class="l l-Scalar l-Scalar-Plain">module.exit_json(changed=check_if_system_state_would_be_changed())</span>
</pre></div>
</div>
<p>Remember that, as module developer, you are responsible for ensuring that no
system state is altered when the user enables check mode.</p>
<p>If your module does not support check mode, when the user runs Ansible in check
mode, your module will simply be skipped.</p>
</div>
<div class="section" id="common-pitfalls">
<span id="module-dev-pitfalls"></span><h2><a class="toc-backref" href="#id14">Common Pitfalls</a><a class="headerlink" href="#common-pitfalls" title="Permalink to this headline">露</a></h2>
<p>You should also never do this in a module:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">print &quot;some status message&quot;</span>
</pre></div>
</div>
<p>Because the output is supposed to be valid JSON.</p>
<p>Modules must not output anything on standard error, because the system will merge
standard out with standard error and prevent the JSON from parsing. Capturing standard
error and returning it as a variable in the JSON on standard out is fine, and is, in fact,
how the command module is implemented.</p>
<p>If a module returns stderr or otherwise fails to produce valid JSON, the actual output
will still be shown in Ansible, but the command will not succeed.</p>
<p>Always use the hacking/test-module script when developing modules and it will warn
you about these kind of things.</p>
</div>
<div class="section" id="conventions-recommendations">
<span id="module-dev-conventions"></span><h2><a class="toc-backref" href="#id15">Conventions/Recommendations</a><a class="headerlink" href="#conventions-recommendations" title="Permalink to this headline">露</a></h2>
<p>As a reminder from the example code above, here are some basic conventions
and guidelines:</p>
<ul class="simple">
<li>If the module is addressing an object, the parameter for that object should be called &#8216;name&#8217; whenever possible, or accept &#8216;name&#8217; as an alias.</li>
<li>If you have a company module that returns facts specific to your installations, a good name for this module is <cite>site_facts</cite>.</li>
<li>Modules accepting boolean status should generally accept &#8216;yes&#8217;, &#8216;no&#8217;, &#8216;true&#8217;, &#8216;false&#8217;, or anything else a user may likely throw at them.  The AnsibleModule common code supports this with &#8220;type=&#8217;bool&#8217;&#8221;.</li>
<li>Include a minimum of dependencies if possible.  If there are dependencies, document them at the top of the module file, and have the module raise JSON error messages when the import fails.</li>
<li>Modules must be self-contained in one file to be auto-transferred by ansible.</li>
<li>If packaging modules in an RPM, they only need to be installed on the control machine and should be dropped into /usr/share/ansible.  This is entirely optional and up to you.</li>
<li>Modules must output valid JSON only. The toplevel return type must be a hash (dictionary) although they can be nested.  Lists or simple scalar values are not supported, though they can be trivially contained inside a dictionary.</li>
<li>In the event of failure, a key of &#8216;failed&#8217; should be included, along with a string explanation in &#8216;msg&#8217;.  Modules that raise tracebacks (stacktraces) are generally considered &#8216;poor&#8217; modules, though Ansible can deal with these returns and will automatically convert anything unparseable into a failed result.  If you are using the AnsibleModule common Python code, the &#8216;failed&#8217; element will be included for you automatically when you call &#8216;fail_json&#8217;.</li>
<li>Return codes from modules are actually not significant, but continue on with 0=success and non-zero=failure for reasons of future proofing.</li>
<li>As results from many hosts will be aggregated at once, modules should return only relevant output.  Returning the entire contents of a log file is generally bad form.</li>
</ul>
</div>
<div class="section" id="documenting-your-module">
<span id="module-documenting"></span><h2><a class="toc-backref" href="#id16">Documenting Your Module</a><a class="headerlink" href="#documenting-your-module" title="Permalink to this headline">露</a></h2>
<p>All modules included in the CORE distribution must have a
<code class="docutils literal"><span class="pre">DOCUMENTATION</span></code> string. This string MUST be a valid YAML document
which conforms to the schema defined below. You may find it easier to
start writing your <code class="docutils literal"><span class="pre">DOCUMENTATION</span></code> string in an editor with YAML
syntax highlighting before you include it in your Python file.</p>
<div class="section" id="example">
<span id="module-doc-example"></span><h3><a class="toc-backref" href="#id17">Example</a><a class="headerlink" href="#example" title="Permalink to this headline">露</a></h3>
<p>See an example documentation string in the checkout under <a class="reference external" href="javascript:if(confirm('https://github.com/ansible/ansible/blob/devel/examples/DOCUMENTATION.yml  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='https://github.com/ansible/ansible/blob/devel/examples/DOCUMENTATION.yml'" tppabs="https://github.com/ansible/ansible/blob/devel/examples/DOCUMENTATION.yml">examples/DOCUMENTATION.yml</a>.</p>
<p>Include it in your module file like this:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="c1">#!/usr/bin/python</span>
<span class="c1"># Copyright header....</span>

<span class="l l-Scalar l-Scalar-Plain">DOCUMENTATION = &#39;&#39;&#39;</span>
<span class="nn">---</span>
<span class="l l-Scalar l-Scalar-Plain">module</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">modulename</span>
<span class="l l-Scalar l-Scalar-Plain">short_description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">This is a sentence describing the module</span>
<span class="c1"># ... snip ...</span>
<span class="s">&#39;</span><span class="se">&#39;&#39;</span>
</pre></div>
</div>
<p>If an argument takes both C(True)/C(False) and C(Yes)/C(No), the documentation should use C(True) and C(False).</p>
<p>The <code class="docutils literal"><span class="pre">description</span></code>, and <code class="docutils literal"><span class="pre">notes</span></code> fields
support formatting with some special macros.</p>
<p>These formatting functions are <code class="docutils literal"><span class="pre">U()</span></code>, <code class="docutils literal"><span class="pre">M()</span></code>, <code class="docutils literal"><span class="pre">I()</span></code>, and <code class="docutils literal"><span class="pre">C()</span></code>
for URL, module, italic, and constant-width respectively. It is suggested
to use <code class="docutils literal"><span class="pre">C()</span></code> for file and option names, and <code class="docutils literal"><span class="pre">I()</span></code> when referencing
parameters; module names should be specified as <code class="docutils literal"><span class="pre">M(module)</span></code>.</p>
<p>Examples (which typically contain colons, quotes, etc.) are difficult
to format with YAML, so these must be
written in plain text in an <code class="docutils literal"><span class="pre">EXAMPLES</span></code> string within the module
like this:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">EXAMPLES = &#39;&#39;&#39;</span>
<span class="l l-Scalar l-Scalar-Plain">- action</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">modulename opt1=arg1 opt2=arg2</span>
<span class="s">&#39;</span><span class="se">&#39;&#39;</span>
</pre></div>
</div>
<p>The EXAMPLES section, just like the documentation section, is required in
all module pull requests for new modules.</p>
<p>The RETURN section documents what the module returns. For each value returned,
provide a <code class="docutils literal"><span class="pre">description</span></code>, in what circumstances the value is <code class="docutils literal"><span class="pre">returned</span></code>,
the <code class="docutils literal"><span class="pre">type</span></code> of the value and a <code class="docutils literal"><span class="pre">sample</span></code>.  For example, from
the <code class="docutils literal"><span class="pre">copy</span></code> module:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">RETURN = &#39;&#39;&#39;</span>
<span class="l l-Scalar l-Scalar-Plain">dest</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">destination file/path</span>
    <span class="l l-Scalar l-Scalar-Plain">returned</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">success</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">string</span>
    <span class="l l-Scalar l-Scalar-Plain">sample</span><span class="p p-Indicator">:</span> <span class="s">&quot;/path/to/file.txt&quot;</span>
<span class="l l-Scalar l-Scalar-Plain">src</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">source file used for the copy on the target machine</span>
    <span class="l l-Scalar l-Scalar-Plain">returned</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">changed</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">string</span>
    <span class="l l-Scalar l-Scalar-Plain">sample</span><span class="p p-Indicator">:</span> <span class="s">&quot;/home/httpd/.ansible/tmp/ansible-tmp-1423796390.97-147729857856000/source&quot;</span>
<span class="l l-Scalar l-Scalar-Plain">md5sum</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">md5 checksum of the file after running copy</span>
    <span class="l l-Scalar l-Scalar-Plain">returned</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">when supported</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">string</span>
    <span class="l l-Scalar l-Scalar-Plain">sample</span><span class="p p-Indicator">:</span> <span class="s">&quot;2a5aeecc61dc98c4d780b14b330e3282&quot;</span>
<span class="nn">...</span>
<span class="s">&#39;</span><span class="se">&#39;&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="building-testing">
<span id="module-dev-testing"></span><h3><a class="toc-backref" href="#id18">Building &amp; Testing</a><a class="headerlink" href="#building-testing" title="Permalink to this headline">露</a></h3>
<p>Put your completed module file into the &#8216;library&#8217; directory and then
run the command: <code class="docutils literal"><span class="pre">make</span> <span class="pre">webdocs</span></code>. The new &#8216;modules.html&#8217; file will be
built and appear in the &#8216;docsite/&#8217; directory.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">If you&#8217;re having a problem with the syntax of your YAML you can
validate it on the <a class="reference external" href="javascript:if(confirm('http://www.yamllint.com/  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='http://www.yamllint.com/'" tppabs="http://www.yamllint.com/">YAML Lint</a> website.</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">You can set the environment variable ANSIBLE_KEEP_REMOTE_FILES=1 on the controlling host to prevent ansible from
deleting the remote files so you can debug your module.</p>
</div>
</div>
</div>
<div class="section" id="debugging-ansiblemodule-based-modules">
<span id="id4"></span><h2><a class="toc-backref" href="#id19">Debugging AnsibleModule-based modules</a><a class="headerlink" href="#debugging-ansiblemodule-based-modules" title="Permalink to this headline">露</a></h2>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">If you&#8217;re using the <code class="file docutils literal"><span class="pre">hacking/test-module</span></code> script then most of this
is taken care of for you.  If you need to do some debugging of the module
on the remote machine that the module will actually run on or when the
module is used in a playbook then you may need to use this information
instead of relying on test-module.</p>
</div>
<p>Starting with Ansible-2.1.0, AnsibleModule-based modules are put together as
a zip file consisting of the module file and the various python module
boilerplate inside of a wrapper script instead of as a single file with all of
the code concatenated together.  Without some help, this can be harder to
debug as the file needs to be extracted from the wrapper in order to see
what&#8217;s actually going on in the module.  Luckily the wrapper script provides
some helper methods to do just that.</p>
<p>If you are using Ansible with the <span class="target" id="index-1"></span><code class="xref std std-envvar docutils literal"><span class="pre">ANSIBLE_KEEP_REMOTE_FILES</span></code>
environment variables to keep the remote module file, here&#8217;s a sample of how
your debugging session will start:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span>$ ANSIBLE_KEEP_REMOTE_FILES=1 ansible localhost -m ping -a &#39;data=debugging_session&#39; -vvv
&lt;127.0.0.1&gt; ESTABLISH LOCAL CONNECTION FOR USER: badger
&lt;127.0.0.1&gt; EXEC /bin/sh -c &#39;( umask 77 &amp;&amp; mkdir -p &quot;` echo $HOME/.ansible/tmp/ansible-tmp-1461434734.35-235318071810595 `&quot; &amp;&amp; echo &quot;` echo $HOME/.ansible/tmp/ansible-tmp-1461434734.35-235318071810595 `&quot; )&#39;
&lt;127.0.0.1&gt; PUT /var/tmp/tmpjdbJ1w TO /home/badger/.ansible/tmp/ansible-tmp-1461434734.35-235318071810595/ping
&lt;127.0.0.1&gt; EXEC /bin/sh -c &#39;LANG=en_US.UTF-8 LC_ALL=en_US.UTF-8 LC_MESSAGES=en_US.UTF-8 /usr/bin/python /home/badger/.ansible/tmp/ansible-tmp-1461434734.35-235318071810595/ping&#39;
localhost | SUCCESS =&gt; {
    &quot;changed&quot;: false,
    &quot;invocation&quot;: {
        &quot;module_args&quot;: {
            &quot;data&quot;: &quot;debugging_session&quot;
        },
        &quot;module_name&quot;: &quot;ping&quot;
    },
    &quot;ping&quot;: &quot;debugging_session&quot;
}
</pre></div>
</div>
<p>Setting <span class="target" id="index-2"></span><code class="xref std std-envvar docutils literal"><span class="pre">ANSIBLE_KEEP_REMOTE_FILE</span></code> to <code class="docutils literal"><span class="pre">1</span></code> tells Ansible to keep the
remote module files instead of deleting them after the module finishes
executing.  Giving Ansible the <code class="docutils literal"><span class="pre">-vvv</span></code> optin makes Ansible more verbose.
That way it prints the file name of the temporary module file for you to see.</p>
<p>If you want to examine the wrapper file you can.  It will show a small python
script with a large, base64 encoded string.  The string contains the module
that is going to be executed.  Run the wrapper&#8217;s explode command to turn the
string into some python files that you can work with:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">$ python /home/badger/.ansible/tmp/ansible-tmp-1461434734.35-235318071810595/ping explode</span>
<span class="l l-Scalar l-Scalar-Plain">Module expanded into</span><span class="p p-Indicator">:</span>
<span class="l l-Scalar l-Scalar-Plain">/home/badger/.ansible/tmp/ansible-tmp-1461434734.35-235318071810595/debug_dir</span>
</pre></div>
</div>
<p>When you look into the debug_dir you&#8217;ll see a directory structure like this:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain"> ansible_module_ping.py</span>
<span class="l l-Scalar l-Scalar-Plain"> args</span>
<span class="l l-Scalar l-Scalar-Plain"> ansible</span>
    <span class="l l-Scalar l-Scalar-Plain"> __init__.py</span>
    <span class="l l-Scalar l-Scalar-Plain"> module_utils</span>
        <span class="l l-Scalar l-Scalar-Plain"> basic.py</span>
        <span class="l l-Scalar l-Scalar-Plain"> __init__.py</span>
</pre></div>
</div>
<ul class="simple">
<li><code class="file docutils literal"><span class="pre">ansible_module_ping.py</span></code> is the code for the module itself.  The name
is based on the name of the module with a prefix so that we don&#8217;t clash with
any other python module names.  You can modify this code to see what effect
it would have on your module.</li>
<li>The <code class="file docutils literal"><span class="pre">args</span></code> file contains a JSON string.  The string is a dictionary
containing the module arguments and other variables that Ansible passes into
the module to change it&#8217;s behaviour.  If you want to modify the parameters
that are passed to the module, this is the file to do it in.</li>
<li>The <code class="file docutils literal"><span class="pre">ansible</span></code> directory contains code from
<code class="xref py py-mod docutils literal"><span class="pre">ansible.module_utils</span></code> that is used by the module.  Ansible includes
files for any :<cite>module:`ansible.module_utils</cite> imports in the module but not
no files from any other module.  So if your module uses
<code class="xref py py-mod docutils literal"><span class="pre">ansible.module_utils.url</span></code> Ansible will include it for you, but if
your module includes <code class="xref py py-mod docutils literal"><span class="pre">requests</span></code> then you&#8217;ll have to make sure that
the python requests library is installed on the system before running the
module.  You can modify files in this directory if you suspect that the
module is having a problem in some of this boilerplate code rather than in
the module code you have written.</li>
</ul>
<p>Once you edit the code or arguments in the exploded tree you need some way to
run it.  There&#8217;s a separate wrapper subcommand for this:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span>$ python /home/badger/.ansible/tmp/ansible-tmp-1461434734.35-235318071810595/ping execute
{&quot;invocation&quot;: {&quot;module_args&quot;: {&quot;data&quot;: &quot;debugging_session&quot;}}, &quot;changed&quot;: false, &quot;ping&quot;: &quot;debugging_session&quot;}
</pre></div>
</div>
<p>This subcommand takes care of setting the PYTHONPATH to use the exploded
<code class="file docutils literal"><span class="pre">debug_dir/ansible/module_utils</span></code> directory and invoking the script using
the arguments in the <code class="file docutils literal"><span class="pre">args</span></code> file.  You can continue to run it like this
until you understand the problem.  Then you can copy it back into your real
module file and test that the real module works via <strong class="command">ansible</strong> or
<strong class="command">ansible-playbook</strong>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The wrapper provides one more subcommand, <code class="docutils literal"><span class="pre">excommunicate</span></code>.  This
subcommand is very similar to <code class="docutils literal"><span class="pre">execute</span></code> in that it invokes the exploded
module on the arguments in the <code class="file docutils literal"><span class="pre">args</span></code>.  The way it does this is
different, however.  <code class="docutils literal"><span class="pre">excommunicate</span></code> imports the <code class="xref py py-func docutils literal"><span class="pre">main()</span></code>
function from the module and then calls that.  This makes excommunicate
execute the module in the wrapper&#8217;s process.  This may be useful for
running the module under some graphical debuggers but it is very different
from the way the module is executed by Ansible itself.  Some modules may
not work with <code class="docutils literal"><span class="pre">excommunicate</span></code> or may behave differently than when used
with Ansible normally.  Those are not bugs in the module; they&#8217;re
limitations of <code class="docutils literal"><span class="pre">excommunicate</span></code>.  Use at your own risk.</p>
</div>
</div>
<div class="section" id="module-paths">
<span id="id5"></span><h2><a class="toc-backref" href="#id20">Module Paths</a><a class="headerlink" href="#module-paths" title="Permalink to this headline">露</a></h2>
<p>If you are having trouble getting your module &#8220;found&#8221; by ansible, be
sure it is in the <span class="target" id="index-3"></span><code class="xref std std-envvar docutils literal"><span class="pre">ANSIBLE_LIBRARY</span></code> environment variable.</p>
<p>If you have a fork of one of the ansible module projects, do something like this:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">ANSIBLE_LIBRARY=~/ansible-modules-core:~/ansible-modules-extras</span>
</pre></div>
</div>
<p>And this will make the items in your fork be loaded ahead of what ships with Ansible.  Just be sure
to make sure you&#8217;re not reporting bugs on versions from your fork!</p>
<p>To be safe, if you&#8217;re working on a variant on something in Ansible&#8217;s normal distribution, it&#8217;s not
a bad idea to give it a new name while you are working on it, to be sure you know you&#8217;re pulling
your version.</p>
</div>
<div class="section" id="getting-your-module-into-ansible">
<span id="module-contribution"></span><h2><a class="toc-backref" href="#id21">Getting Your Module Into Ansible</a><a class="headerlink" href="#getting-your-module-into-ansible" title="Permalink to this headline">露</a></h2>
<p>High-quality modules with minimal dependencies
can be included in Ansible, but modules (just due to the programming
preferences of the developers) will need to be implemented in Python and use
the AnsibleModule common code, and should generally use consistent arguments with the rest of
the program.   Stop by the mailing list to inquire about requirements if you like, and submit
a github pull request to the <a class="reference external" href="javascript:if(confirm('https://github.com/ansible/ansible-modules-extras  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='https://github.com/ansible/ansible-modules-extras'" tppabs="https://github.com/ansible/ansible-modules-extras">extras</a> project.
Included modules will ship with ansible, and also have a chance to be promoted to &#8216;core&#8217; status, which
gives them slightly higher development priority (though they&#8217;ll work in exactly the same way).</p>
</div>
<div class="section" id="module-checklist">
<h2><a class="toc-backref" href="#id22">Module checklist</a><a class="headerlink" href="#module-checklist" title="Permalink to this headline">露</a></h2>
<p>The following  checklist items are important guidelines for people who want to contribute to the development of modules to Ansible on GitHub. Please read the guidelines before you submit your PR/proposal.</p>
<ul>
<li><p class="first">The shebang should always be <code class="docutils literal"><span class="pre">#!/usr/bin/python</span></code>, this allows ansible_python_interpreter to work</p>
</li>
<li><p class="first">Modules must be written to support Python 2.4. If this is not possible, required minimum python version and rationale should be explained in the requirements section in DOCUMENTATION.</p>
</li>
<li><p class="first">Modules must be written to use proper Python-3 syntax.  At some point in the future we&#8217;ll come up with rules for running on Python-3 but we&#8217;re not there yet.  See <a class="reference internal" href="developing_modules_python3.html" tppabs="https://docs.ansible.com/ansible/developing_modules_python3.html"><span class="doc">Porting Modules to Python 3</span></a> for help on how to do this.</p>
</li>
<li><dl class="first docutils">
<dt>Documentation: Make sure it exists</dt>
<dd><ul class="first last simple">
<li>Module documentation should briefly and accurately define what each module and option does, and how it works with others in the underlying system. Documentation should be written for broad audience&#8211;readable both by experts and non-experts. This documentation is not meant to teach a total novice, but it also should not be reserved for the Illuminati (hard balance).</li>
<li>If an argument takes both C(True)/C(False) and C(Yes)/C(No), the documentation should use C(True) and C(False).</li>
<li>Descriptions should always start with a Capital letter and end with a full stop. Consistency always helps.</li>
<li>The <cite>required</cite> setting is only required when true, otherwise it is assumed to be false.</li>
<li>If <cite>required</cite> is false/missing, <cite>default</cite> may be specified (assumed &#8216;null&#8217; if missing). Ensure that the default parameter in docs matches default parameter in code.</li>
<li>Documenting <cite>default</cite> is not needed for <cite>required: true</cite>.</li>
<li>Remove unnecessary doc like <cite>aliases: []</cite> or <cite>choices: []</cite>.</li>
<li>The version is not a float number and value the current development version.</li>
<li>Verify that arguments in doc and module spec dict are identical.</li>
<li>For password / secret arguments no_log=True should be set.</li>
<li>Requirements should be documented, using the <cite>requirements=[]</cite> field.</li>
<li>Author should be set, with their name and their github id, at the least.</li>
<li>Ensure that you make use of U() for urls, C() for files and options, I() for params, M() for modules.</li>
<li>If an optional parameter is sometimes required this need to be reflected in the documentation, e.g. &#8220;Required when C(state=present).&#8221;</li>
<li>Verify that a GPL 3 License header is included.</li>
<li>Does module use check_mode? Could it be modified to use it? Document it. Documentation is everyone&#8217;s friend.</li>
<li>Examples&#8211;include them whenever possible and make sure they are reproducible.</li>
<li>Document the return structure of the module. Refer to <a class="reference internal" href="common_return_values.html#common-return-values" tppabs="https://docs.ansible.com/ansible/common_return_values.html#common-return-values"><span class="std std-ref">Common Return Values</span></a> and <a class="reference internal" href="#module-documenting"><span class="std std-ref">Documenting Your Module</span></a> for additional information.</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Predictable user interface: This is a particularly important section as it is also an area where we need significant improvements.</dt>
<dd><ul class="first last simple">
<li>Name consistency across modules (weve gotten better at this, but we still have many deviations).</li>
<li>Declarative operation (not CRUD)&#8211;this makes it easy for a user not to care what the existing state is, just about the final state. <code class="docutils literal"><span class="pre">started/stopped</span></code>, <code class="docutils literal"><span class="pre">present/absent</span></code>&#8211;don&#8217;t overload options too much. It is preferable to add a new, simple option than to add choices/states that don&#8217;t fit with existing ones.</li>
<li>Keep options small, having them take large data structures might save us a few tasks, but adds a complex requirement that we cannot easily validate before passing on to the module.</li>
<li>Allow an &#8220;expert mode&#8221;. This may sound like the absolute opposite of the previous one, but it is always best to let expert users deal with complex data. This requires different modules in some cases, so that you end up having one (1) expert module and several &#8216;piecemeal&#8217; ones (ec2_vpc_net?). The reason for this is not, as many users express, because it allows a single task and keeps plays small (which just moves the data complexity into vars files, leaving you with a slightly different structure in another YAML file). It does, however, allow for a more &#8216;atomic&#8217; operation against the underlying APIs and services.</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Informative responses: Please note, that for  &gt;= 2.0, it is required that return data to be documented.</dt>
<dd><ul class="first last simple">
<li>Always return useful data, even when there is no change.</li>
<li>Be consistent about returns (some modules are too random), unless it is detrimental to the state/action.</li>
<li>Make returns reusable&#8211;most of the time you don&#8217;t want to read it, but you do want to process it and re-purpose it.</li>
<li>Return diff if in diff mode. This is not required for all modules, as it won&#8217;t make sense for certain ones, but please attempt to include this when applicable).</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Code: This applies to all code in general, but often seems to be missing from modules, so please keep the following in mind as you work.</dt>
<dd><ul class="first last simple">
<li>Validate upfront&#8211;fail fast and return useful and clear error messages.</li>
<li>Defensive programming&#8211;modules should be designed simply enough that this should be easy. Modules should always handle errors gracefully and avoid direct stacktraces. Ansible deals with this better in 2.0 and returns them in the results.</li>
<li>Fail predictably&#8211;if we must fail, do it in a way that is the most expected. Either mimic the underlying tool or the general way the system works.</li>
<li>Modules should not do the job of other modules, that is what roles are for. Less magic is more.</li>
<li>Don&#8217;t reinvent the wheel. Part of the problem is that code sharing is not that easy nor documented, we also need to expand our base functions to provide common patterns (retry, throttling, etc).</li>
<li>Support check mode. This is not required for all modules, as it won&#8217;t make sense for certain ones, but please attempt to include this when applicable). For more information, refer to <a class="reference internal" href="test_strategies.html#check-mode-drift" tppabs="https://docs.ansible.com/ansible/test_strategies.html#check-mode-drift"><span class="std std-ref">Check Mode As A Drift Test</span></a> and <a class="reference internal" href="playbooks_checkmode.html#check-mode-dry" tppabs="https://docs.ansible.com/ansible/playbooks_checkmode.html#check-mode-dry"><span class="std std-ref">Check Mode (&#8220;Dry Run&#8221;)</span></a>.</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Exceptions: The module must handle them. (exceptions are bugs)</dt>
<dd><ul class="first last simple">
<li>Give out useful messages on what you were doing and you can add the exception message to that.</li>
<li>Avoid catchall exceptions, they are not very useful unless the underlying API gives very good error messages pertaining the attempted action.</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Module-dependent guidelines: Additional module guidelines may exist for certain families of modules.</dt>
<dd><ul class="first last">
<li><dl class="first docutils">
<dt>Be sure to check out the modules themselves for additional information.</dt>
<dd><ul class="first last simple">
<li>Amazon: <a class="reference external" href="javascript:if(confirm('https://github.com/ansible/ansible-modules-extras/blob/devel/cloud/amazon/GUIDELINES.md  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='https://github.com/ansible/ansible-modules-extras/blob/devel/cloud/amazon/GUIDELINES.md'" tppabs="https://github.com/ansible/ansible-modules-extras/blob/devel/cloud/amazon/GUIDELINES.md">https://github.com/ansible/ansible-modules-extras/blob/devel/cloud/amazon/GUIDELINES.md</a></li>
</ul>
</dd>
</dl>
</li>
<li><p class="first">Modules should make use of the &#8220;extends_documentation_fragment&#8221; to ensure documentation available. For example, the AWS module should include:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">extends_documentation_fragment</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">aws</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ec2</span>
</pre></div>
</div>
</li>
</ul>
</dd>
</dl>
</li>
<li><p class="first">The module must not use sys.exit() &#8211;&gt; use fail_json() from the module object.</p>
</li>
<li><p class="first">Import custom packages in try/except and handled with fail_json() in main() e.g.:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">try</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">import foo</span>
    <span class="l l-Scalar l-Scalar-Plain">HAS_LIB=True</span>
<span class="l l-Scalar l-Scalar-Plain">except</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">HAS_LIB=False</span>
</pre></div>
</div>
</li>
<li><p class="first">The return structure should be consistent, even if NA/None are used for keys normally returned under other options.</p>
</li>
<li><p class="first">Are module actions idempotent? If not document in the descriptions or the notes.</p>
</li>
<li><p class="first">Import module snippets <cite>from ansible.module_utils.basic import *</cite> at the bottom, conserves line numbers for debugging.</p>
</li>
<li><p class="first">The module must have a <cite>main</cite> function that wraps the normal execution.</p>
</li>
<li><p class="first">Call your <code class="xref py py-func docutils literal"><span class="pre">main()</span></code> from a conditional so that it would be possible to
import them into unittests in the future example:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">if __name__ == &#39;__main__&#39;</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">main()</span>
</pre></div>
</div>
</li>
<li><p class="first">Try to normalize parameters with other modules, you can have aliases for when user is more familiar with underlying API name for the option</p>
</li>
<li><p class="first">Being pep8 compliant is nice, but not a requirement. Specifically, the 80 column limit now hinders readability more that it improves it</p>
</li>
<li><p class="first">Avoid &#8216;<cite>action</cite>/<cite>command</cite>&#8216;, they are imperative and not declarative, there are other ways to express the same thing</p>
</li>
<li><p class="first">Do not add <cite>list</cite> or <cite>info</cite> state options to an existing module - create a new <cite>_facts</cite> module.</p>
</li>
<li><p class="first">If you are asking &#8216;how can I have a module execute other modules&#8217; ... you want to write a role</p>
</li>
<li><p class="first">Return values must be able to be serialized as json via the python stdlib
json library.  basic python types (strings, int, dicts, lists, etc) are
serializable.  A common pitfall is to try returning an object via
exit_json().  Instead, convert the fields you need from the object into the
fields of a dictionary and return the dictionary.</p>
</li>
<li><p class="first">When fetching URLs, please use either fetch_url or open_url from ansible.module_utils.urls
rather than urllib2; urllib2 does not natively verify TLS certificates and so is insecure for https.</p>
</li>
</ul>
</div>
<div class="section" id="windows-modules-checklist">
<h2><a class="toc-backref" href="#id23">Windows modules checklist</a><a class="headerlink" href="#windows-modules-checklist" title="Permalink to this headline">露</a></h2>
<ul>
<li><p class="first">Favour native powershell and .net ways of doing things over calls to COM libraries or calls to native executables which may or may not be present in all versions of windows</p>
</li>
<li><p class="first">modules are in powershell (.ps1 files) but the docs reside in same name python file (.py)</p>
</li>
<li><p class="first">look at ansible/lib/ansible/module_utils/powershell.ps1 for common code, avoid duplication</p>
</li>
<li><p class="first">Ansible uses strictmode version 2.0 so be sure to test with that enabled</p>
</li>
<li><p class="first">start with:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="c1">#!powershell</span>
</pre></div>
</div>
<p>then:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">&lt;GPL header&gt;</span>
</pre></div>
</div>
<p>then:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="c1"># WANT_JSON</span>
<span class="c1"># POWERSHELL_COMMON</span>
</pre></div>
</div>
<p>then, to parse all arguments into a variable modules generally use:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">$params = Parse-Args $args</span>
</pre></div>
</div>
</li>
<li><dl class="first docutils">
<dt>Arguments:</dt>
<dd><ul class="first last">
<li><p class="first">Try and use state present and state absent like other modules</p>
</li>
<li><p class="first">You need to check that all your mandatory args are present. You can do this using the builtin Get-AnsibleParam function.</p>
</li>
<li><p class="first">Required arguments:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">$package =  Get-AnsibleParam -obj $params -name name -failifempty $true</span>
</pre></div>
</div>
</li>
<li><p class="first">Required arguments with name validation:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">$state = Get-AnsibleParam -obj $params -name &quot;State&quot; -ValidateSet &quot;Present&quot;,&quot;Absent&quot; -resultobj $resultobj -failifempty $true</span>
</pre></div>
</div>
</li>
<li><p class="first">Optional arguments with name validation:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">$state = Get-AnsibleParam -obj $params -name &quot;State&quot; -default &quot;Present&quot; -ValidateSet &quot;Present&quot;,&quot;Absent&quot;</span>
</pre></div>
</div>
</li>
<li><p class="first">the If &#8220;FailIfEmpty&#8221; is true, the resultobj parameter is used to specify the object returned to fail-json. You can also override the default message
using $emptyattributefailmessage (for missing required attributes) and $ValidateSetErrorMessage (for attribute validation errors)</p>
</li>
<li><p class="first">Look at existing modules for more examples of argument checking.</p>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Results</dt>
<dd><ul class="first last">
<li><p class="first">The result object should allways contain an attribute called changed set to either $true or $false</p>
</li>
<li><p class="first">Create your result object like this:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">$result = New-Object psobject @{</span>
<span class="l l-Scalar l-Scalar-Plain">changed = $false</span>
<span class="l l-Scalar l-Scalar-Plain">other_result_attribute = $some_value</span>
<span class="l l-Scalar l-Scalar-Plain">};</span>

<span class="l l-Scalar l-Scalar-Plain">If all is well, exit with a</span>
<span class="l l-Scalar l-Scalar-Plain">Exit-Json $result</span>
</pre></div>
</div>
</li>
<li><p class="first">Ensure anything you return, including errors can be converted to json.</p>
</li>
<li><p class="first">Be aware that because exception messages could contain almost anything.</p>
</li>
<li><p class="first">ConvertTo-Json will fail if it encounters a trailing in a string.</p>
</li>
<li><p class="first">If all is not well use Fail-Json to exit.</p>
</li>
</ul>
</dd>
</dl>
</li>
<li><p class="first">Have you tested for powershell 3.0 and 4.0 compliance?</p>
</li>
</ul>
</div>
<div class="section" id="deprecating-and-making-module-aliases">
<h2><a class="toc-backref" href="#id24">Deprecating and making module aliases</a><a class="headerlink" href="#deprecating-and-making-module-aliases" title="Permalink to this headline">露</a></h2>
<p>Starting in 1.8, you can deprecate modules by renaming them with a preceding _, i.e. old_cloud.py to
_old_cloud.py. This keeps the module available, but hides it from the primary docs and listing.</p>
<p>You can also rename modules and keep an alias to the old name by using a symlink that starts with _.
This example allows the stat module to be called with fileinfo, making the following examples equivalent:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">EXAMPLES = &#39;&#39;&#39;</span>
<span class="l l-Scalar l-Scalar-Plain">ln -s stat.py _fileinfo.py</span>
<span class="l l-Scalar l-Scalar-Plain">ansible -m stat -a &quot;path=/tmp&quot; localhost</span>
<span class="l l-Scalar l-Scalar-Plain">ansible -m fileinfo -a &quot;path=/tmp&quot; localhost</span>
<span class="l l-Scalar l-Scalar-Plain">&#39;&#39;&#39;</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<dl class="last docutils">
<dt><a class="reference internal" href="modules.html" tppabs="https://docs.ansible.com/ansible/modules.html"><span class="doc">About Modules</span></a></dt>
<dd>Learn about available modules</dd>
<dt><a class="reference internal" href="developing_plugins.html" tppabs="https://docs.ansible.com/ansible/developing_plugins.html"><span class="doc">Developing Plugins</span></a></dt>
<dd>Learn about developing plugins</dd>
<dt><a class="reference internal" href="developing_api.html" tppabs="https://docs.ansible.com/ansible/developing_api.html"><span class="doc">Python API</span></a></dt>
<dd>Learn about the Python API for playbook and task execution</dd>
<dt><a class="reference external" href="javascript:if(confirm('https://github.com/ansible/ansible-modules-core/tree/devel  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='https://github.com/ansible/ansible-modules-core/tree/devel'" tppabs="https://github.com/ansible/ansible-modules-core/tree/devel">GitHub Core modules directory</a></dt>
<dd>Browse source of core modules</dd>
<dt><a class="reference external" href="javascript:if(confirm('https://github.com/ansible/ansible-modules-extras/tree/devel  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='https://github.com/ansible/ansible-modules-extras/tree/devel'" tppabs="https://github.com/ansible/ansible-modules-extras/tree/devel">Github Extras modules directory</a></dt>
<dd>Browse source of extras modules.</dd>
<dt><a class="reference external" href="javascript:if(confirm('http://groups.google.com/group/ansible-devel  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='http://groups.google.com/group/ansible-devel'" tppabs="http://groups.google.com/group/ansible-devel">Mailing List</a></dt>
<dd>Development mailing list</dd>
<dt><a class="reference external" href="javascript:if(confirm('http://irc.freenode.net/  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='http://irc.freenode.net/'" tppabs="http://irc.freenode.net/">irc.freenode.net</a></dt>
<dd>#ansible IRC chat channel</dd>
</dl>
</div>
</div>
</div>


          </div>
          <div id="search-results"><gcse:searchresults-only></div>
          <footer>
  
    <div class="rst-footer-buttons">
      
        <a href="developing_plugins.html" tppabs="https://docs.ansible.com/ansible/developing_plugins.html" class="btn btn-neutral float-right" title="Developing Plugins"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="developing_inventory.html" tppabs="https://docs.ansible.com/ansible/developing_inventory.html" class="btn btn-neutral" title="Developing Dynamic Inventory Sources"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','st.js'/*tpa=https://s.swiftypecdn.com/install/v2/st.js*/,'_st');

  _st('install','yABGvz2N8PwcwBxyfzUc','2.0.0');
</script>

  <p>
  Copyright 漏 2016 Red Hat, Inc.
  <br>
    Last updated on Jun 22, 2016.
  </p>
<p>
Ansible docs are generated from <a href="javascript:if(confirm('https://github.com/ansible/ansible  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='https://github.com/ansible/ansible'" tppabs="https://github.com/ansible/ansible">GitHub sources</A> using <A HREF="javascript:if(confirm('http://sphinx-doc.org/  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='http://sphinx-doc.org/'" tppabs="http://sphinx-doc.org/">Sphinx</A> using a theme provided by <a href="javascript:if(confirm('http://readthedocs.org/  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='http://readthedocs.org/'" tppabs="http://readthedocs.org/">Read the Docs</a>. 
</p>
</footer>
        </div>
      </div>

    </section>

  </div>
  


<!-- begin analytics -->
<script type="text/javascript">
var _hsq = _hsq || [];
_hsq.push(["setContentType", "standard-page"]);
        (function(d,s,i,r) {
        if (d.getElementById(i)){return;}
        var n = d.createElement(s),e = document.getElementsByTagName(s)[0];
        n.id=i;n.src = '//js.hs-analytics.net/analytics/'+(Math.ceil(new Date()/r)*r)+'/330046.js';
        e.parentNode.insertBefore(n, e);
        })(document, "script", "hs-analytics",300000);
</script>
<!-- end analytics -->

</body>
</html>